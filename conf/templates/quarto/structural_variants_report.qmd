---
title: "{{PROJECT_NAME}} - Structural Variants Quality Control Report"
subtitle: "{{GENE_NAME}} Gene Analysis"
author: "{{PROJECT_AUTHOR}} ({{PROJECT_CODE}})"
date: "`r Sys.Date()`"
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 4
    toc-location: left
    code-fold: true
    code-summary: "Show code"
    embed-resources: true
    self-contained: true
    self-contained-math: true
    keep-md: false
    fig-width: 10
    fig-height: 6
execute:
  echo: false
  warning: false
  message: false
lightbox:
  match: auto
  effect: zoom
  desc-position: bottom
  loop: true
---

```{r setup}
#| include: false
library(tidyverse)
library(knitr)
library(kableExtra)
library(DT)
library(plotly)
library(gt)

# Set global options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center")

# Define data directory
data_dir <- "data"

# Project information from pipeline
project_info <- list(
  code = "{{PROJECT_CODE}}",
  name = "{{PROJECT_NAME}}",
  author = "{{PROJECT_AUTHOR}}",
  gene = "{{GENE_NAME}}"
)

# Function to render and display plots with specific order
display_plots_by_pattern <- function(data_dir, pattern_base, gene_name, var_type, plot_order) {
  # Define plot patterns in order: frequency, translocations, copy number, inversions
  plot_patterns <- c(
    "Frec_SVtype",
    "Circle_Translocation", 
    "CNV_Size_CN",
    "Inversions_Segments"
  )
  
  # Plot descriptions for captions
  plot_descriptions <- c(
    "structural variant frequency distribution by type",
    "translocation patterns in circular representation", 
    "copy number variant size and copy number analysis",
    "inversion segments analysis"
  )
  
  displayed_plots <- 0
  
  for (i in seq_along(plot_patterns)) {
    pattern <- plot_patterns[i]
    description <- plot_descriptions[i]
    
    # Construct expected filename
    plot_file <- paste0(gene_name, "_", pattern_base, "_", var_type, "_", pattern, ".pdf")
    pdf_path <- file.path(data_dir, plot_file)
    
    if (file.exists(pdf_path)) {
      displayed_plots <- displayed_plots + 1
      img <- pdftools::pdf_render_page(pdf_path, page = 1, dpi = 300)
      png_filename <- paste0(tolower(var_type), "_", pattern, "_", displayed_plots, ".png")
      png::writePNG(img, png_filename)
      
      cat('![](', png_filename, '){width="100%"}\n\n', sep = "")
      cat('**_Figure:_** *', str_to_title(var_type), ' ', description, ' for {{GENE_NAME}}.*\n\n', sep = "")
    }
  }
  
  if (displayed_plots == 0) {
    cat("⚠️ No ", var_type, " plots found for pattern: ", pattern_base, "\n\n")
  }
  
  invisible(displayed_plots)
}

# Function to display participant metadata plots - Auto-detect all PartMetadata files
display_metadata_plots <- function(data_dir, pattern_base, gene_name, var_type) {
  # Search for all PartMetadata files matching the pattern automatically
  search_pattern <- paste0(gene_name, "_", pattern_base, "_", var_type, "_PartMetadata_.*\\.pdf$")
  metadata_files <- list.files(data_dir, pattern = search_pattern, full.names = TRUE)
  
  displayed_plots <- 0
  
  if (length(metadata_files) > 0) {
    # Sort files to ensure "AllStructuralVar" comes first
    metadata_files <- sort(metadata_files)
    all_struct_idx <- grep("AllStructuralVar|AllstructuralVar", metadata_files, ignore.case = TRUE)
    
    if (length(all_struct_idx) > 0) {
      # Move "All structural variants" to the beginning
      all_struct_file <- metadata_files[all_struct_idx[1]]
      other_files <- metadata_files[-all_struct_idx[1]]
      metadata_files <- c(all_struct_file, other_files)
    }
    
    # Generate unique lightbox group for this pattern and var_type
    lightbox_group <- paste0(tolower(var_type), "-metadata-", gsub("[^a-zA-Z0-9]", "", pattern_base))
    
    # Display ONLY the first image (AllStructuralVar), rest accessible via lightbox
    pdf_path <- metadata_files[1]
    pdf_name <- basename(pdf_path)
    
    # Convert first PDF to PNG and display
    if (requireNamespace("pdftools", quietly = TRUE) && requireNamespace("png", quietly = TRUE)) {
      tryCatch({
        displayed_plots <- displayed_plots + 1
        img <- pdftools::pdf_render_page(pdf_path, page = 1, dpi = 300)
        png_filename <- paste0(tolower(var_type), "_metadata_", displayed_plots, ".png")
        png::writePNG(img, png_filename)
        
        # Display the main image with lightbox group
        cat('\n<div style="margin: 30px 0; text-align: center;">\n')
        cat('  <img src="', png_filename, '" style="width:90%; height:auto; border:1px solid #dee2e6; border-radius:4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" alt="Participant Metadata - All Structural Variants" data-gallery="', lightbox_group, '" />\n', sep = "")
        cat('</div>\n\n')
        
      }, error = function(e) {
        cat('\n<div style="padding:20px; background:#f8d7da; border:1px solid #f5c2c7; border-radius:5px;">\n')
        cat('  <p style="color:#842029; margin:0;">Could not convert PDF: ', pdf_name, '</p>\n')
        cat('</div>\n\n')
      })
    }
    
    # Process remaining PDFs but DON'T display them (only for lightbox)
    if (length(metadata_files) > 1) {
      for (pdf_idx in 2:length(metadata_files)) {
        pdf_path <- metadata_files[pdf_idx]
        pdf_name <- basename(pdf_path)
        
        if (file.exists(pdf_path)) {
          if (requireNamespace("pdftools", quietly = TRUE) && requireNamespace("png", quietly = TRUE)) {
            tryCatch({
              displayed_plots <- displayed_plots + 1
              img <- pdftools::pdf_render_page(pdf_path, page = 1, dpi = 300)
              png_filename <- paste0(tolower(var_type), "_metadata_", displayed_plots, ".png")
              png::writePNG(img, png_filename)
              
              # Hidden images for lightbox (display:none)
              cat('<img src="', png_filename, '" style="display:none;" data-gallery="', lightbox_group, '" />\n', sep = "")
              
            }, error = function(e) {
              # Silent fail for hidden images
            })
          }
        }
      }
    }
  }
  
  if (displayed_plots == 0) {
    cat("⚠️ No ", var_type, " metadata plots found for pattern: ", pattern_base, "\n\n")
  }
  
  invisible(displayed_plots)
}
```

# Executive Summary

This report presents a detailed quality control analysis of structural variants (CNVs and SVs) identified in the **{{GENE_NAME}}** 
gene as part of the **{{PROJECT_CODE}}** research initiative. The analysis includes comprehensive QC visualizations for both 
germline and somatic variants, basic and custom filtering strategies, and detailed statistical summaries of variant distributions 
and participant metadata.

Key components of this report include:

- Quality control visualizations of CNV and SV distributions for germline and somatic variants
- Participant metadata analysis with demographic and clinical context  
- Comprehensive filtering analysis distinguishing somatic and germline variants
- Interactive tables for detailed variant exploration
- Statistical summaries of all analysis steps

---

# Raw Structural Variants QC

This section presents the quality control analysis of raw structural variants, organized by germline and somatic classifications 
to provide clear insights into the distinct patterns and characteristics of each variant type in the {{GENE_NAME}} gene.

## Germline Variants

### 1. Structural Variant Distribution and Classification
Below are quality-control plots providing a concise overview of germline structural variants identified in the {{GENE_NAME}} gene. 
The figures summarize variant type frequencies, translocation patterns, copy-number size and CN analyses, 
and inversion segment summaries to support interpretation and downstream filtering decisions.

```{r qc-germline-distribution}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

# Display germline plots in specific order: frequency, translocations, copy number, inversions
display_plots_by_pattern(data_dir, "QC", project_info$gene, "germline", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))
```

### 2. Participant Metadata Analysis

```{r qc-germline-metadata}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_metadata_plots(data_dir, "QC", project_info$gene, "germline")
```

## Somatic Variants

### 1. Structural Variant Distribution and Classification

```{r qc-somatic-distribution}
#| echo: false  
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_plots_by_pattern(data_dir, "QC", project_info$gene, "somatic", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))
```

### 2. Participant Metadata Analysis

```{r qc-somatic-metadata}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_metadata_plots(data_dir, "QC", project_info$gene, "somatic")
```

---

# Filtering Analysis

This section presents the results of filtering analysis applied to structural variants, organized by variant classification 
to provide comprehensive insights into germline and somatic variant patterns after quality control filtering.

## Basic Filtering

This subsection presents the results of basic filtering applied to the structural variants dataset. Basic filtering includes 
standard quality thresholds, frequency cutoffs, and classification criteria for CNVs and SVs.

### Basic Filtering Statistics

```{r basic-filter-stats-table}
#| echo: false

# Load basic filtering statistics
basic_stats_files <- list.files(data_dir, pattern = "*_struct_variants_filter_basic_stats\\.csv$", full.names = TRUE)

if (length(basic_stats_files) > 0) {
  basic_stats <- read_csv(basic_stats_files[1], show_col_types = FALSE)
  
  if (nrow(basic_stats) > 0) {
    # Create a nicely formatted table using gt
    basic_stats %>%
      mutate(
        metric = case_when(
          metric == "total_raw_variants" ~ "Total Raw Structural Variants",
          metric == "total_canonical_variants" ~ "Total Canonical Structural Variants", 
          metric == "total_canonical_cnv" ~ "   • CNV Variants",
          metric == "total_canonical_sv" ~ "   • SV Variants",
          metric == "total_canonical_germline" ~ "   • Germline Variants",
          metric == "total_canonical_somatic" ~ "   • Somatic Variants",
          TRUE ~ metric
        )
      ) %>%
      gt() %>%
      tab_header(
        title = paste("Basic Filtering Statistics for", project_info$gene),
        subtitle = "Progressive filtering steps with structural variant counts and number of participants"
      ) %>%
      cols_label(
        metric = "Filtering Step",
        variant_count = "Variant Count",
        participant_count = "Participant Count"
      ) %>%
      tab_style(
        style = list(
          cell_fill(color = "#f8f9fa"),
          cell_text(weight = "bold")
        ),
        locations = cells_column_labels()
      ) %>%
      fmt_number(
        columns = c(variant_count, participant_count),
        decimals = 0
      )
  } else {
    cat("No basic filtering statistics data available.")
  }
} else {
  cat("No basic filtering statistics files found.")
}
```

**_Table 1:_** *Progressive filtering statistics showing the impact of each filtering step on structural variant and participant counts.*

### Germline Basic Filtered Variants

#### 1. Structural Variant Distribution and Classification

```{r basic-filter-germline-distribution}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_plots_by_pattern(data_dir, "structural_variants_filter_basic", project_info$gene, "germline", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))
```

#### 2. Participant Metadata Analysis

```{r basic-filter-germline-metadata}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_metadata_plots(data_dir, "structural_variants_filter_basic", project_info$gene, "germline")
```

### Somatic Basic Filtered Variants

#### 1. Structural Variant Distribution and Classification

```{r basic-filter-somatic-distribution}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_plots_by_pattern(data_dir, "structural_variants_filter_basic", project_info$gene, "somatic", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))
```

#### 2. Participant Metadata Analysis

```{r basic-filter-somatic-metadata}
#| echo: false
#| results: asis
#| fig-width: 10
#| fig-height: 6

display_metadata_plots(data_dir, "structural_variants_filter_basic", project_info$gene, "somatic")
```

### Filtered Variants Table

```{r basic-filtered-variants-table}
#| echo: false

# Load basic filtered variants for interactive table
basic_filtered_files <- list.files(data_dir, pattern = "*_struct_variants_filter_basic_filtered\\.rds$", full.names = TRUE)

if (length(basic_filtered_files) > 0) {
  basic_filtered_data <- map_dfr(basic_filtered_files, ~{
    data <- readRDS(.x)
    if (is.data.frame(data) && nrow(data) > 0) {
      data
    } else {
      NULL 
    }
  })
  
  if (!is.null(basic_filtered_data) && nrow(basic_filtered_data) > 0) {
    # Select specific columns for display - adapt for structural variants
    display_cols <- c(
      "LabelVarPlot", "CHR_variant", "START_variant", "END_variant", 
      "SVTYPE_variant", "SVLEN_variant", "Classification_variant", 
      "MAX_AF_annotation", "NS_variant"
    )
    
    # Filter to available columns
    available_cols <- intersect(display_cols, names(basic_filtered_data))
    
    # Create interactive table with download buttons
    dt_table <- basic_filtered_data %>%
      select(any_of(available_cols)) %>%
      datatable(
        caption = paste("Basic Filtered Structural Variants (Combined Germline and Somatic) for", project_info$gene),
        filter = 'top',
        extensions = c('Buttons'),
        options = list(
          pageLength = 10,
          scrollX = TRUE,
          autoWidth = TRUE,
          columnDefs = list(
            list(className = 'dt-center', targets = '_all')
          ),
          dom = 'Bfrtip',
          buttons = list(
            'copy',
            list(extend = 'csv', filename = paste0(project_info$gene, '_basic_filtered_struct_variants')),
            list(extend = 'excel', filename = paste0(project_info$gene, '_basic_filtered_struct_variants')),
            list(extend = 'pdf', filename = paste0(project_info$gene, '_basic_filtered_struct_variants'))
          )
        ),
        rownames = FALSE,
        class = 'cell-border stripe hover'
      )
    
    # Format SVTYPE column if it exists
    if ("SVTYPE_variant" %in% available_cols) {
      dt_table <- dt_table %>%
        formatStyle(
          'SVTYPE_variant',
          backgroundColor = styleEqual(
            c('DEL', 'DUP', 'INS', 'INV', 'BND', 'CNV'),
            c('#ffcccc', '#ccffcc', '#ffffcc', '#ccccff', '#ffccff', '#e6e6e6')
          )
        )
    }
    
    dt_table
  } else {
    cat("No basic filtered structural variant data available.")
  }
} else {
  cat("No basic filtered structural variants RDS files found.")
}
```

**_Table 2:_** *Interactive table of structural variants (combined germline and somatic) that passed basic filtering criteria for {{GENE_NAME}}. 
Use the search and filter features to explore specific variants of interest. Note: Tables typically contain both germline and somatic variants combined.*

---

```{r custom-filters-detection}
#| echo: false

# Detect custom filters by looking for non-basic filter files
all_filter_stats <- list.files(data_dir, pattern = ".*struct_variants_filter_.*_stats\\.csv$", full.names = TRUE)
custom_filter_stats <- all_filter_stats[!grepl("filter_basic", all_filter_stats)]

# Extract unique custom filter names
custom_filter_names <- c()
for (file in custom_filter_stats) {
  filter_match <- str_extract(basename(file), "filter_[^_]+")
  if (!is.na(filter_match) && filter_match != "filter_basic") {
    custom_filter_names <- c(custom_filter_names, filter_match)
  }
}
custom_filter_names <- unique(custom_filter_names)
```

```{r custom-filters-sections, results='asis'}
#| echo: false

if (length(custom_filter_names) > 0) {
  for (filter_name in custom_filter_names) {
    # Clean filter name for display
    filter_display <- str_replace_all(filter_name, "_", " ") %>% str_to_title()
    filter_name_clean <- str_replace_all(filter_name, "filter_", "")
    
    # Main filter section
    cat('\n## ', str_to_title(filter_display), ' Filtering\n\n', sep = "")
    cat('This subsection presents the results of ', tolower(filter_display), ' applied to the structural variants dataset.\n\n', sep = "")
    
    # Statistics subsection
    cat('\n### ', str_to_title(filter_display), ' Statistics\n\n', sep = "")
    
    # Stats table for this custom filter
    custom_stats_file <- list.files(data_dir, pattern = paste0(".*", filter_name, "_stats\\.csv$"), full.names = TRUE)
    
    if (length(custom_stats_file) > 0) {
      cat('\n```{r custom-', filter_name_clean, '-filter-stats-table}\n')
      cat('#| echo: false\n\n')
      cat('custom_stats <- read_csv("', basename(custom_stats_file[1]), '", show_col_types = FALSE)\n', sep = "")
      cat('\nif (nrow(custom_stats) > 0) {\n')
      cat('  stats_table <- custom_stats %>%\n')
      cat('    filter(grepl("', filter_name, '_after_custom_filtering", metric)) %>%\n', sep = "")
      cat('    mutate(\n')
      cat('      metric = paste("Final', str_to_title(filter_display), 'Structural Variants")\n')
      cat('    ) %>%\n')
      cat('    gt() %>%\n')
      cat('    tab_header(\n')
      cat('      title = paste("', str_to_title(filter_display), 'Filtering Statistics"),\n', sep = "")
      cat('      subtitle = paste("Custom filtering results for", project_info$gene)\n')
      cat('    ) %>%\n')
      cat('    cols_label(\n')
      cat('      metric = "Filtering Step",\n')
      cat('      variant_count = "Variant Count",\n')
      cat('      participant_count = "Participant Count"\n')
      cat('    ) %>%\n')
      cat('    fmt_number(\n')
      cat('      columns = c(variant_count, participant_count),\n')
      cat('      decimals = 0\n')
      cat('    )\n')
      cat('  \n')
      cat('  print(stats_table)\n')
      cat('} else {\n')
      cat('  cat("No ', tolower(filter_display), ' filtering statistics data available.")\n', sep = "")
      cat('}\n')
      cat('```\n\n')
    }
    
    cat('**_Table:_** *', str_to_title(filter_display), ' filtering statistics for structural variants.*\n\n', sep = "")
    
    # Germline Custom Filtered Variants section
    cat('\n### Germline ', str_to_title(filter_display), ' Filtered Variants\n\n', sep = "")
    cat('\n#### 1. Structural Variant Distribution and Classification\n\n')
    
    cat('\n```{r custom-', filter_name_clean, '-germline-distribution}\n', sep = "")
    cat('#| echo: false\n')
    cat('#| results: asis\n')
    cat('#| fig-width: 10\n')
    cat('#| fig-height: 6\n\n')
    # Display plots directly without generating titles
    cat('display_plots_by_pattern(data_dir, "', filter_name, '", project_info$gene, "germline", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))\n', sep = "")
    cat('```\n\n')
    
    cat('\n#### 2. Participant Metadata Analysis\n\n')
    cat('\n```{r custom-', filter_name_clean, '-germline-metadata}\n', sep = "")
    cat('#| echo: false\n')
    cat('#| results: asis\n')
    cat('#| fig-width: 10\n')
    cat('#| fig-height: 6\n\n')
    # Display plots directly without generating titles
    cat('display_metadata_plots(data_dir, "', filter_name, '", project_info$gene, "germline")\n', sep = "")
    cat('```\n\n')
    
    # Somatic Custom Filtered Variants section
    cat('\n### Somatic ', str_to_title(filter_display), ' Filtered Variants\n\n', sep = "")
    cat('\n#### 1. Structural Variant Distribution and Classification\n\n')
    
    cat('\n```{r custom-', filter_name_clean, '-somatic-distribution}\n', sep = "")
    cat('#| echo: false\n')
    cat('#| results: asis\n')
    cat('#| fig-width: 10\n')
    cat('#| fig-height: 6\n\n')
    # Display plots directly without generating titles
    cat('display_plots_by_pattern(data_dir, "', filter_name, '", project_info$gene, "somatic", c("Frec_SVtype", "Circle_Translocation", "CNV_Size_CN", "Inversions_Segments"))\n', sep = "")
    cat('```\n\n')
    
    cat('\n#### 2. Participant Metadata Analysis\n\n')
    cat('\n```{r custom-', filter_name_clean, '-somatic-metadata}\n', sep = "")
    cat('#| echo: false\n')
    cat('#| results: asis\n')
    cat('#| fig-width: 10\n')
    cat('#| fig-height: 6\n\n')
    # Display plots directly without generating titles
    cat('display_metadata_plots(data_dir, "', filter_name, '", project_info$gene, "somatic")\n', sep = "")
    cat('```\n\n')
    
    # Filtered Variants Table subsection
    cat('\n### Filtered Variants Table\n\n')
    
    cat('\n```{r custom-', filter_name_clean, '-filtered-variants-table}\n', sep = "")
    cat('#| echo: false\n\n')
    cat('custom_filtered_files <- list.files(data_dir, pattern = ".*', filter_name, '_filtered\\\\.rds$", full.names = TRUE)\n', sep = "")
    cat('\n')
    cat('if (length(custom_filtered_files) > 0) {\n')
    cat('  custom_filtered_data <- readRDS(custom_filtered_files[1])\n')
    cat('  \n')
    cat('  if (is.data.frame(custom_filtered_data) && nrow(custom_filtered_data) > 0) {\n')
    cat('    display_cols <- c(\n')
    cat('      "LabelVarPlot", "CHR_variant", "START_variant", "END_variant",\n')
    cat('      "SVTYPE_variant", "SVLEN_variant", "Classification_variant",\n')
    cat('      "MAX_AF_annotation", "NS_variant"\n')
    cat('    )\n')
    cat('    \n')
    cat('    available_cols <- intersect(display_cols, names(custom_filtered_data))\n')
    cat('    \n')
    cat('    dt_table <- custom_filtered_data %>%\n')
    cat('      select(any_of(available_cols)) %>%\n')
    cat('      datatable(\n')
    cat('        caption = paste("', str_to_title(filter_display), ' Filtered Structural Variants (Combined Germline and Somatic) for", project_info$gene),\n', sep = "")
    cat('        filter = "top",\n')
    cat('        extensions = c("Buttons"),\n')
    cat('        options = list(\n')
    cat('          pageLength = 10,\n')
    cat('          scrollX = TRUE,\n')
    cat('          autoWidth = TRUE,\n')
    cat('          columnDefs = list(\n')
    cat('            list(className = "dt-center", targets = "_all")\n')
    cat('          ),\n')
    cat('          dom = "Bfrtip",\n')
    cat('          buttons = list(\n')
    cat('            "copy",\n')
    cat('            list(extend = "csv", filename = paste0(project_info$gene, "_', filter_name_clean, '_filtered_struct_variants")),\n', sep = "")
    cat('            list(extend = "excel", filename = paste0(project_info$gene, "_', filter_name_clean, '_filtered_struct_variants")),\n', sep = "")
    cat('            list(extend = "pdf", filename = paste0(project_info$gene, "_', filter_name_clean, '_filtered_struct_variants"))\n', sep = "")
    cat('          )\n')
    cat('        ),\n')
    cat('        rownames = FALSE,\n')
    cat('        class = "cell-border stripe hover"\n')
    cat('      )\n')
    cat('    \n')
    cat('    if ("SVTYPE_variant" %in% available_cols) {\n')
    cat('      dt_table <- dt_table %>%\n')
    cat('        formatStyle("SVTYPE_variant", backgroundColor = styleEqual(c("DEL", "DUP", "INS", "INV", "BND", "CNV"), c("#ffcccc", "#ccffcc", "#ffffcc", "#ccccff", "#ffccff", "#e6e6e6")))\n')
    cat('    }\n')
    cat('    \n')
    cat('    dt_table\n')
    cat('  } else {\n')
    cat('    cat("No ', tolower(filter_display), ' filtered structural variants available.")\n', sep = "")
    cat('  }\n')
    cat('} else {\n')
    cat('  cat("No filtered structural variants table found for ', tolower(filter_display), '.")\n', sep = "")
    cat('}\n')
    cat('```\n\n')
    
    cat('**_Table:_** *Interactive table of structural variants (combined germline and somatic) that passed ', tolower(filter_display), ' for {{GENE_NAME}}. Note: Tables typically contain both germline and somatic variants combined.*\n\n', sep = "")
    
    cat('\n---\n\n')
  }
} else {
  cat("No custom filtering has been applied to this structural variants dataset.\n\n")
}
```

---

# Report Information

**Pipeline Details:**  
- **Project Code**: {{PROJECT_CODE}}  
- **Project Name**: {{PROJECT_NAME}}  
- **Gene Analyzed**: {{GENE_NAME}}  
- **Report Type**: Structural Variants Quality Control  
- **Analysis Author**: {{PROJECT_AUTHOR}}  
- **Report Format**: HTML (Self-contained)  
- **Generation Date**: `r Sys.Date()`  
- **R Version**: `r R.version.string`  

---

*This report was generated automatically by the {{PROJECT_CODE}} Nextflow pipeline using Quarto.*  
*For questions about the analysis or interpretations, please contact the project team.*